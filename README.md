# Barbershop REST API (Django 5)

Полноценная back-end-система для автоматизации работы барбершопа: учёт клиентов, сотрудников, услуг, залов и визитов с возможностью онлайн-бронирования.

---

## Содержание
* [Функциональные возможности](#функциональные-возможности)
* [Стек технологий](#стек-технологий)
* [Быстрый старт](#быстрый-старт)
* [Структура проекта](#структура-проекта)
* [Описание моделей](#описание-моделей)
* [Аутентификация](#аутентификация)
* [REST-эндпоинты](#rest-эндпоинты)
* [Алгоритм расчёта свободного времени](#алгоритм-расчёта-свободного-времени)
* [Тестирование](#тестирование)
* [Полезные команды](#полезные-команды)
* [Лицензия](#лицензия)

---

## Функциональные возможности
* Регистрация и авторизация клиентов и сотрудников (токен-аутентификация).
* CRUD-операции для залов, услуг и сотрудников (доступны администраторам).
* Клиентская запись на услуги с учётом занятости залов и рабочего расписания.
* Автоматический выбор зала и предотвращение переполнения.
* Просмотр визитов:
  * Клиент – свои записи.
  * Сотрудник – свои приёмы.
  * Администратор – все визиты.
* Автоматическое обновление статуса визита («Запланирована» → «Выполнена»).

## Стек технологий
| Категория             | Технологии                                   |
|-----------------------|----------------------------------------------|
| Язык / Фреймворк      | Python 3.12, Django 5.1, Django REST Framework |
| БД                    | SQLite 3 (по умолчанию)                      |
| Аутентификация        | `rest_authtoken` (token auth)                |
| Прочее                | Pandas (формирование HTML-таблиц)            |

## Быстрый старт
```bash
# 1. Клонируйте репозиторий
$ git clone <repo-url> && cd barbershop

# 2. Создайте и активируйте виртуальное окружение
$ python -m venv venv
$ source venv/Scripts/activate  # Windows PowerShell

# 3. Установите зависимости
(venv)$ pip install djangorestframework pandas

# 4. Примените миграции и создайте суперпользователя
(venv)$ python manage.py migrate
(venv)$ python manage.py createsuperuser

# 5. Запустите сервер
(venv)$ python manage.py runserver 127.0.0.1:8000
```
Теперь API доступен по `http://127.0.0.1:8000/`.

## Структура проекта
```
barbershop/
├── barbershop/           # core (settings, urls, wsgi)
├── barbershopapp/        # все бизнес-модели и REST-логика
│   ├── models.py
│   ├── serializers.py
│   ├── views.py
│   ├── urls.py
│   ├── time_slots.py     # алгоритм свободных слотов
│   └── migrations/
├── static/               # статические файлы (css, js, images)
├── manage.py
└── README.md             
```

## Описание моделей
| Модель       | Поля (ключевые) | Назначение |
|--------------|-----------------|------------|
| `Hall`       | `name`, `capacity`, `location`, `start_time`, `end_time` | Зал обслуживания.
| `Service`    | `name`, `price`, `duration` | Оказваемая услуга.
| `Client`     | FK `User`, `phone_number`, `date_of_birth`, `gender` | Клиент барбершопа.
| `Employee`   | FK `User`, M2M `halls`, M2M `services` | Сотрудник/мастер.
| `ServiceHall`| FK `Service`, FK `Hall` | Связующая таблица «услуга-зал».
| `Visit`      | FK `Client`, `Employee`, `Service`, `Hall`, `date`, `time`, `status` | Запись клиента.



## Аутентификация
Используется токен-аутентификация DRF. Получить токен:
```bash
curl -X POST -d "username=<login>&password=<pass>" \
     http://127.0.0.1:8000/api-token-auth/
```
Ответ: `{ "token": "<your-token>" }`

Передавайте заголовок `Authorization: Token <token>` во всех защищённых запросах.

## REST-эндпоинты
Ниже краткая шпаргалка (полные примеры в `docs/API_REFERENCE.md`).

| Метод | URL | Описание |
|-------|-----|----------|
| POST | `/registration/client/` | Регистрация клиента |
| POST | `/registration/employee/` | Регистрация сотрудника (admin) |
| GET  | `/client/profile/` | Профиль клиента |
| PUT  | `/client/update/` | Обновить клиента |
| POST | `/hall/add/` | Создать зал (admin) |
| GET  | `/hall/show/` | Список залов |
| DELETE | `/hall/delete/<id>/` | Удалить зал |
| POST | `/book/visit/` | Забронировать визит |
| GET  | `/get_available_time/?employee=&service=&date=` | Свободные слоты |
| ...  | см. полный перечень в docs |

## Алгоритм расчёта свободного времени
Функция `get_time_slots` (см. `barbershopapp/time_slots.py`):
1. Берёт рабочий интервал `start_time`—`end_time` выбранного зала.
2. Получает продолжительность услуги в минутах.
3. Формирует список уже занятых слотов (`Visit`) на указанную дату.
4. Итеративно «шагает» по интервалу с шагом = длительность услуги и добавляет слот, если он не пересекается с занятыми.



